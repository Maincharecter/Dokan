<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶Æ‡ßÅ‡¶¶‡¶ø ‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ - ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ OCR</title>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
<style>
body { 
    font-family: Arial, sans-serif; 
    background: #f0f8ff; 
    padding: 20px; 
    text-align: center; 
    margin: 0;
}
.container { 
    max-width: 1000px; 
    margin: auto; 
    background: #fff; 
    padding: 20px; 
    border-radius: 10px; 
    box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
}
table { 
    width: 100%; 
    margin-top: 20px; 
    border-collapse: collapse; 
    table-layout: fixed;
}
table, th, td { 
    border: 1px solid #ddd; 
    word-wrap: break-word;
}
th, td { 
    padding: 10px; 
    text-align: center; 
}
#loading, #stockLoading { 
    margin-top: 10px; 
    color: green; 
    font-weight: bold; 
    display: none; 
}
input, select { 
    padding: 8px; 
    margin: 5px; 
    border: 1px solid #ddd; 
    border-radius: 5px; 
    width: 150px;
}
button { 
    padding: 8px 12px; 
    margin: 5px; 
    border: none; 
    background: #007bff; 
    color: #fff; 
    border-radius: 5px; 
    cursor: pointer; 
    font-size: 14px; 
}
button:hover { 
    background: #0056b3; 
}
.delete-btn { 
    background: #dc3545; 
}
.delete-btn:hover { 
    background: #a71d2a; 
}
.edit-btn { 
    background: #ffc107; 
    color: #000; 
}
.edit-btn:hover { 
    background: #d39e00; 
}
.demo-section { 
    margin: 20px 0; 
    padding: 15px; 
    background: #f0f8ff; 
    border-radius: 8px; 
}
.demo-images { 
    display: flex; 
    justify-content: space-around; 
    margin: 20px 0; 
    flex-wrap: wrap; 
}
.demo-image { 
    margin: 10px; 
    text-align: center; 
}
.demo-image img { 
    max-width: 300px; 
    border: 1px solid #ddd; 
    border-radius: 5px; 
}
.instructions { 
    background: #fff3cd; 
    padding: 15px; 
    border-radius: 8px; 
    margin: 20px 0; 
    text-align: left; 
}
.alert {
    padding: 10px;
    margin: 10px 0;
    border-radius: 5px;
    display: none;
}
.alert-success {
    background: #d4edda;
    color: #155724;
}
.alert-error {
    background: #f8d7da;
    color: #721c24;
}
.section {
    margin: 25px 0;
    padding: 15px;
    border: 1px solid #eee;
    border-radius: 8px;
}
@media (max-width: 768px) {
    input, select {
        width: 100%;
        margin: 5px 0;
    }
    button {
        width: 100%;
        margin: 5px 0;
    }
    .demo-images {
        flex-direction: column;
    }
}
</style>
</head>
<body>
<div class="container">
<h2>üõí ‡¶Æ‡ßÅ‡¶¶‡¶ø ‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ - ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ OCR</h2>

<div class="alert" id="alertBox"></div>

<div class="instructions">
<h3>üìã ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡ßá‡¶∂‡¶ø‡¶ï‡¶æ:</h3>
<ol>
<li>‡¶°‡ßá‡¶Æ‡ßã ‡¶õ‡¶¨‡¶ø ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶¨‡¶æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</li>
<li>‡¶∏‡ßç‡¶ü‡¶ï ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá "‡¶∏‡ßç‡¶ü‡¶ï ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®" ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</li>
<li>‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶ï‡¶∞‡¶§‡ßá "‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®" ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</li>
<li>OCR ‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡¶°‡¶º‡¶¨‡ßá ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßç‡¶ü‡¶ï/‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø ‡¶π‡¶æ‡¶≤‡¶®‡¶æ‡¶ó‡¶æ‡¶¶ ‡¶ï‡¶∞‡¶¨‡ßá‡•§</li>
</ol>
</div>

<!-- Demo images -->
<div class="demo-section">
<h3>üì∑ ‡¶°‡ßá‡¶Æ‡ßã ‡¶õ‡¶¨‡¶ø‡¶∏‡¶Æ‡ßÇ‡¶π</h3>
<div class="demo-images">
<div class="demo-image">
<h4>‡¶°‡ßá‡¶Æ‡ßã ‡¶∏‡ßç‡¶ü‡¶ï ‡¶õ‡¶¨‡¶ø</h4>
<img src="https://i.ibb.co/4T2y0c2/stock-demo.png" alt="‡¶∏‡ßç‡¶ü‡¶ï ‡¶°‡ßá‡¶Æ‡ßã ‡¶õ‡¶¨‡¶ø">
<p><a href="https://i.ibb.co/4T2y0c2/stock-demo.png" download>‚¨áÔ∏è ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</a></p>
</div>
<div class="demo-image">
<h4>‡¶°‡ßá‡¶Æ‡ßã ‡¶¨‡¶ø‡¶≤ ‡¶õ‡¶¨‡¶ø</h4>
<img src="https://i.ibb.co/6RJ2M1C/bill-demo.png" alt="‡¶¨‡¶ø‡¶≤ ‡¶°‡ßá‡¶Æ‡ßã ‡¶õ‡¶¨‡¶ø">
<p><a href="https://i.ibb.co/6RJ2M1C/bill-demo.png" download>‚¨áÔ∏è ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</a></p>
</div>
</div>
</div>

<div class="section">
<h3>üì∑ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
<input type="file" id="stockInput" accept="image/*"><br>
<p id="stockLoading">‡¶∏‡ßç‡¶ü‡¶ï ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>

<h3>‡¶Ö‡¶•‡¶¨‡¶æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤‡¶ø ‡¶∏‡ßç‡¶ü‡¶ï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
<div>
    <input type="text" id="productName" placeholder="‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
    <input type="number" id="productQty" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" min="0" step="0.01">
    <select id="unit">
        <option value="kg">‡¶ï‡ßá‡¶ú‡¶ø</option>
        <option value="pcs">‡¶™‡¶ø‡¶∏</option>
        <option value="pack">‡¶™‡ßç‡¶Ø‡¶æ‡¶ï</option>
        <option value="liter">‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞</option>
        <option value="feet">‡¶´‡ßÅ‡¶ü</option>
    </select>
    <button onclick="addStock()">‡¶∏‡ßç‡¶ü‡¶ï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>
</div>

<div class="section">
<h3>üì¶ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡ßç‡¶ü‡¶ï</h3>
<table id="inventoryTable">
<thead>
<tr>
<th width="40%">‡¶™‡¶£‡ßç‡¶Ø</th>
<th width="30%">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th>
<th width="30%">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<div class="section">
<h3>üìù ‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
<input type="file" id="billInput" accept="image/*"><br>
<p id="loading">‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá... ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
</div>

<div class="section">
<h3>üßæ ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</h3>
<button onclick="exportCSV()">‚¨áÔ∏è ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶∞ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
<table id="salesTable">
<thead>
<tr>
<th width="25%">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
<th width="35%">‡¶™‡¶£‡ßç‡¶Ø</th>
<th width="25%">‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá</th>
<th width="15%">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
</div>

<script>
// Initialize data with proper error handling
let inventory = {};
let salesHistory = [];

try {
    const storedInventory = localStorage.getItem("inventory");
    const storedSales = localStorage.getItem("salesHistory");
    
    inventory = storedInventory ? JSON.parse(storedInventory) : {};
    salesHistory = storedSales ? JSON.parse(storedSales) : [];
} catch (e) {
    console.error("Error loading data from localStorage:", e);
    showAlert("‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶∞‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§", "error");
}

const inventoryTable = document.querySelector("#inventoryTable tbody");
const salesTable = document.querySelector("#salesTable tbody");
const loading = document.getElementById("loading");
const stockLoading = document.getElementById("stockLoading");
const alertBox = document.getElementById("alertBox");

// Show alert message
function showAlert(message, type = "success") {
    alertBox.textContent = message;
    alertBox.className = `alert alert-${type}`;
    alertBox.style.display = "block";
    
    setTimeout(() => {
        alertBox.style.display = "none";
    }, 5000);
}

// Convert Bengali digits to number
function bnToNumber(bn) {
    if (!bn) return NaN;
    
    const map = {
        '‡ß¶': '0', '‡ßß': '1', '‡ß®': '2', '‡ß©': '3', '‡ß™': '4',
        '‡ß´': '5', '‡ß¨': '6', '‡ß≠': '7', '‡ßÆ': '8', '‡ßØ': '9'
    };
    
    const cleaned = bn.toString().replace(/[‡ß¶-‡ßØ]/g, m => map[m] || m);
    return parseFloat(cleaned.replace(/[^\d.]/g, ''));
}

// Normalize text from OCR
function normalizeText(text) {
    if (!text) return "";
    
    return text
        .replace(/O/g, '0')
        .replace(/l/g, '1')
        .replace(/I/g, '1')
        .replace(/[^\w\s\.\-‡ß¶-‡ßØ‡¶Ö-‡¶π‡¶ï-‡¶∞\s]/g, '')
        .trim();
}

// Extract product information from text line
function extractProductInfo(line) {
    line = normalizeText(line);
    
    // Try to match patterns like "‡¶ö‡¶æ‡¶≤ ‡ß´ ‡¶ï‡ßá‡¶ú‡¶ø" or "‡¶ö‡¶æ‡¶≤ 5 kg"
    const patterns = [
        /(.+?)\s+([\d.‡ß¶-‡ßØ]+)\s*(‡¶ï‡ßá‡¶ú‡¶ø|‡¶™‡¶ø‡¶∏|‡¶™‡ßç‡¶Ø‡¶æ‡¶ï|‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞|‡¶´‡ßÅ‡¶ü|kg|pcs|pack|liter|feet)/i,
        /(.+?)\s+([\d.‡ß¶-‡ßØ]+)/i
    ];
    
    for (const pattern of patterns) {
        const match = line.match(pattern);
        if (match) {
            const name = match[1].trim();
            const qty = bnToNumber(match[2]);
            let unit = match[3] ? match[3].toLowerCase() : "pcs";
            
            // Map English units to Bengali
            const unitMap = {
                'kg': '‡¶ï‡ßá‡¶ú‡¶ø', 'pcs': '‡¶™‡¶ø‡¶∏', 'pack': '‡¶™‡ßç‡¶Ø‡¶æ‡¶ï', 
                'liter': '‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞', 'feet': '‡¶´‡ßÅ‡¶ü'
            };
            
            unit = unitMap[unit] || unit;
            
            if (!isNaN(qty) && name && qty > 0) {
                return { name, qty, unit };
            }
        }
    }
    
    return null;
}

// Process image for stock or bill
async function processImage(file, type) {
    const loader = type === 'stock' ? stockLoading : loading;
    loader.style.display = "block";
    
    try {
        const { data: { text } } = await Tesseract.recognize(file, 'ben+eng');
        loader.style.display = "none";
        
        const lines = text.split("\n").filter(l => l.trim());
        const today = new Date().toLocaleString('bn-BD');
        let processedCount = 0;
        
        for (const line of lines) {
            const productInfo = extractProductInfo(line);
            
            if (productInfo) {
                const { name, qty, unit } = productInfo;
                
                if (type === 'stock') {
                    if (!inventory[name]) {
                        inventory[name] = { qty: 0, unit: unit };
                    }
                    inventory[name].qty += qty;
                    processedCount++;
                } else {
                    if (inventory[name]) {
                        if (inventory[name].qty >= qty) {
                            inventory[name].qty -= qty;
                            salesHistory.push({
                                date: today,
                                product: name,
                                quantity: qty,
                                unit: inventory[name].unit
                            });
                            processedCount++;
                        } else {
                            showAlert(`‚ö†Ô∏è ${name} ‡¶è‡¶∞ ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶®‡ßá‡¶á‡•§ ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ${inventory[name].qty} ${inventory[name].unit} ‡¶Ü‡¶õ‡ßá‡•§`, "error");
                        }
                    } else {
                        showAlert(`‚ö†Ô∏è ${name} ‡¶™‡¶£‡ßç‡¶Ø‡¶ü‡¶ø ‡¶∏‡ßç‡¶ü‡¶ï‡ßá ‡¶®‡ßá‡¶á‡•§ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶∏‡ßç‡¶ü‡¶ï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`, "error");
                    }
                }
            }
        }
        
        if (processedCount > 0) {
            renderInventory();
            renderSales();
            saveData();
            showAlert(`‚úÖ ${processedCount}‡¶ü‡¶ø ‡¶™‡¶£‡ßç‡¶Ø ${type === 'stock' ? '‡¶∏‡ßç‡¶ü‡¶ï' : '‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø'} ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!`);
        } else {
            showAlert("‚ùå ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡¶£‡ßç‡¶Ø ‡¶∏‡¶®‡¶æ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶∞‡¶ì ‡¶∏‡ßç‡¶™‡¶∑‡ßç‡¶ü ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®‡•§", "error");
        }
    } catch (error) {
        loader.style.display = "none";
        showAlert("‚ùå ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: " + error.message, "error");
    }
}

// Event listeners for file inputs
document.getElementById("stockInput").addEventListener("change", e => {
    const file = e.target.files[0]; 
    if (file) processImage(file, "stock");
    e.target.value = ''; // Reset input
});

document.getElementById("billInput").addEventListener("change", e => {
    const file = e.target.files[0]; 
    if (file) processImage(file, "bill");
    e.target.value = ''; // Reset input
});

function saveData() {
    try {
        localStorage.setItem("inventory", JSON.stringify(inventory));
        localStorage.setItem("salesHistory", JSON.stringify(salesHistory));
    } catch (e) {
        console.error("Error saving data to localStorage:", e);
        showAlert("‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§", "error");
    }
}

function addStock() {
    const name = document.getElementById("productName").value.trim();
    const qty = parseFloat(document.getElementById("productQty").value);
    const unit = document.getElementById("unit").value;
    
    if (name && !isNaN(qty) && qty > 0) {
        if (!inventory[name]) {
            inventory[name] = { qty: 0, unit: unit };
        } else if (inventory[name].unit !== unit) {
            showAlert(`‚ö†Ô∏è ‡¶á‡¶â‡¶®‡¶ø‡¶ü ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá‡¶á ‡¶≠‡¶ø‡¶®‡ßç‡¶®! ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶á‡¶â‡¶®‡¶ø‡¶ü: ${inventory[name].unit}`, "error");
            return;
        }
        
        inventory[name].qty += qty;
        renderInventory();
        saveData();
        
        document.getElementById("productName").value = "";
        document.getElementById("productQty").value = "";
        
        showAlert(`‚úÖ ${qty} ${unit} ${name} ‡¶∏‡ßç‡¶ü‡¶ï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!`);
    } else {
        showAlert("‚ùå ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®", "error");
    }
}

function editStock(product) {
    const newQty = prompt(`${product} ‡¶è‡¶∞ ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®:`, inventory[product].qty);
    if (newQty !== null && !isNaN(newQty) && newQty >= 0) {
        inventory[product].qty = parseFloat(newQty);
        renderInventory();
        saveData();
        showAlert(`‚úÖ ${product} ‡¶è‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!`);
    }
}

function deleteStock(product) {
    if (confirm(`${product} ‡¶∏‡ßç‡¶ü‡¶ï ‡¶•‡ßá‡¶ï‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®?`)) {
        delete inventory[product];
        renderInventory();
        saveData();
        showAlert(`‚úÖ ${product} ‡¶∏‡ßç‡¶ü‡¶ï ‡¶•‡ßá‡¶ï‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!`);
    }
}

function deleteSale(index) {
    if (confirm("‡¶è‡¶á ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®?")) {
        const sale = salesHistory[index];
        // Restore stock if needed
        if (inventory[sale.product]) {
            inventory[sale.product].qty += sale.quantity;
        }
        
        salesHistory.splice(index, 1);
        renderSales();
        renderInventory();
        saveData();
        showAlert("‚úÖ ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
    }
}

function renderInventory() {
    if (!inventoryTable) return;
    
    inventoryTable.innerHTML = "";
    
    if (Object.keys(inventory).length === 0) {
        inventoryTable.innerHTML = `<tr><td colspan="3">‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡ßç‡¶ü‡¶ï ‡¶®‡ßá‡¶á</td></tr>`;
        return;
    }
    
    for (const [name, data] of Object.entries(inventory)) {
        inventoryTable.innerHTML += `
            <tr>
                <td>${name}</td>
                <td>${data.qty} ${data.unit}</td>
                <td>
                    <button class="edit-btn" onclick="editStock('${name}')">‡¶è‡¶°‡¶ø‡¶ü</button>
                    <button class="delete-btn" onclick="deleteStock('${name}')">‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button>
                </td>
            </tr>`;
    }
}

function renderSales() {
    if (!salesTable) return;
    
    salesTable.innerHTML = "";
    
    if (salesHistory.length === 0) {
        salesTable.innerHTML = `<tr><td colspan="4">‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶®‡ßá‡¶á</td></tr>`;
        return;
    }
    
    salesHistory.forEach((sale, index) => {
        salesTable.innerHTML += `
            <tr>
                <td>${sale.date}</td>
                <td>${sale.product}</td>
                <td>${sale.quantity} ${sale.unit}</td>
                <td>
                    <button class="delete-btn" onclick="deleteSale(${index})">‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button>
                </td>
            </tr>`;
    });
}

function exportCSV() {
    if (salesHistory.length === 0) {
        showAlert("‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶®‡ßá‡¶á!", "error");
        return;
    }
    
    let csv = "data:text/csv;charset=utf-8,‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ,‡¶™‡¶£‡ßç‡¶Ø,‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø,‡¶á‡¶â‡¶®‡¶ø‡¶ü\n";
    salesHistory.forEach(sale => {
        csv += `"${sale.date}","${sale.product}",${sale.quantity},${sale.unit}\n`;
    });
    
    const encodedUri = encodeURI(csv);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "sales_report.csv");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// Initialize sample inventory if empty
if (Object.keys(inventory).length === 0) {
    inventory = {
        "‡¶ö‡¶æ‡¶≤": { qty: 50, unit: "‡¶ï‡ßá‡¶ú‡¶ø" },
        "‡¶°‡¶æ‡¶≤": { qty: 30, unit: "‡¶ï‡ßá‡¶úi" },
        "‡¶Ü‡¶ü‡¶æ": { qty: 40, unit: "‡¶ï‡ßá‡¶ú‡¶ø" },
        "‡¶§‡ßá‡¶≤": { qty: 20, unit: "‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞" },
        "‡¶∏‡¶æ‡¶¨‡¶æ‡¶®": { qty: 50, unit: "‡¶™‡¶ø‡¶∏" }
    };
    saveData();
}

// Initial render
renderInventory();
renderSales();
</script>
</body>
</html>